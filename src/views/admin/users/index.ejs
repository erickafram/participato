<%- include('../layouts/main', { body: `
<div class="page-header">
  <h1><i class="bi bi-people me-2"></i>Usuários</h1>
  <a href="/admin/users/create" class="btn btn-primary">
    <i class="bi bi-plus-lg me-1"></i>Novo Usuário
  </a>
</div>

<div class="card">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead>
          <tr>
            <th style="width: 50px;"></th>
            <th>Nome</th>
            <th>Email</th>
            <th>Função</th>
            <th>Status</th>
            <th>Último Acesso</th>
            <th style="width: 120px;">Ações</th>
          </tr>
        </thead>
        <tbody>
          ${users && users.length > 0 
            ? users.map(u => '<tr>' +
                '<td>' +
                  (u.avatar 
                    ? '<img src="' + u.avatar + '" alt="" class="rounded-circle" style="width: 40px; height: 40px; object-fit: cover;">'
                    : '<div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">' + u.name.charAt(0).toUpperCase() + '</div>'
                  ) +
                '</td>' +
                '<td><strong>' + u.name + '</strong></td>' +
                '<td>' + u.email + '</td>' +
                '<td><span class="badge ' + (u.role === 'admin' ? 'bg-danger' : 'bg-primary') + '">' + (u.role === 'admin' ? 'Admin' : 'Editor') + '</span></td>' +
                '<td>' + (u.active ? '<span class="badge bg-success">Ativo</span>' : '<span class="badge bg-secondary">Inativo</span>') + '</td>' +
                '<td>' + (u.last_login ? new Date(u.last_login).toLocaleString('pt-BR') : 'Nunca') + '</td>' +
                '<td>' +
                  '<div class="btn-group btn-group-sm">' +
                    '<a href="/admin/users/' + u.id + '/edit" class="btn btn-outline-primary" title="Editar"><i class="bi bi-pencil"></i></a>' +
                    '<button type="button" class="btn btn-outline-danger" onclick="deleteUser(' + u.id + ')" title="Excluir"><i class="bi bi-trash"></i></button>' +
                  '</div>' +
                '</td>' +
              '</tr>').join('')
            : '<tr><td colspan="7" class="text-center text-muted py-5">Nenhum usuário encontrado</td></tr>'
          }
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Delete Form -->
<form id="deleteForm" method="POST" style="display: none;"></form>

<script>
function deleteUser(id) {
  if (confirm('Tem certeza que deseja excluir este usuário?')) {
    const form = document.getElementById('deleteForm');
    form.action = '/admin/users/' + id + '/delete';
    form.submit();
  }
}
</script>
`}) %>
