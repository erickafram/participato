<%- include('../layouts/main', { body: `
<div class="home-editor">
  <div class="editor-header">
    <div>
      <h1><i class="bi bi-layout-wtf"></i> Editor da Home</h1>
      <p>Arraste e organize os blocos para personalizar a página inicial</p>
    </div>
    <button class="btn-add-block" onclick="openAddBlockModal()">
      <i class="bi bi-plus-lg"></i> Adicionar Bloco
    </button>
  </div>

  <div class="editor-content">
    <!-- Preview da Home -->
    <div class="editor-preview">
      <div class="preview-header">
        <span><i class="bi bi-eye"></i> Preview da Home</span>
        <a href="/" target="_blank" class="preview-link">Ver Site <i class="bi bi-box-arrow-up-right"></i></a>
      </div>
      
      <div class="blocks-container" id="blocksContainer">
        ` + (blocks && blocks.length > 0 
          ? blocks.map(function(block) {
              var iconMap = {
                'featured': 'bi-star-fill',
                'grid-2': 'bi-grid',
                'grid-3': 'bi-grid-3x2-gap',
                'grid-4': 'bi-grid-fill',
                'list-vertical': 'bi-list-ul',
                'big-left': 'bi-layout-sidebar',
                'big-right': 'bi-layout-sidebar-reverse',
                'carousel': 'bi-collection-play',
                'banner': 'bi-image',
                'highlight-2': 'bi-columns-gap',
                'news-ticker': 'bi-broadcast'
              };
              var labelMap = {
                'featured': 'Destaque Principal',
                'grid-2': 'Grid 2 Colunas',
                'grid-3': 'Grid 3 Colunas',
                'grid-4': 'Grid 4 Colunas',
                'list-vertical': 'Lista Vertical',
                'big-left': 'Grande à Esquerda',
                'big-right': 'Grande à Direita',
                'carousel': 'Carrossel',
                'banner': 'Banner',
                'highlight-2': '2 Destaques',
                'news-ticker': 'Ticker de Notícias'
              };
              return '<div class="block-item ' + (!block.active ? 'inactive' : '') + '" data-id="' + block.id + '" data-type="' + block.type + '">' +
                '<div class="block-drag-handle"><i class="bi bi-grip-vertical"></i></div>' +
                '<div class="block-preview">' +
                  '<div class="block-type-icon"><i class="bi ' + (iconMap[block.type] || 'bi-square') + '"></i></div>' +
                  '<div class="block-info">' +
                    '<span class="block-type-label">' + (labelMap[block.type] || block.type) + '</span>' +
                    '<span class="block-title">' + (block.title || (block.category ? block.category.name : 'Todas as categorias')) + '</span>' +
                    (block.type === 'banner' && block.banner ? '<span class="block-banner">Banner: ' + block.banner.title + '</span>' : '') +
                  '</div>' +
                '</div>' +
                '<div class="block-status">' +
                  (block.active ? '<span class="status-badge active"><i class="bi bi-check-circle"></i> Ativo</span>' : '<span class="status-badge inactive"><i class="bi bi-pause-circle"></i> Inativo</span>') +
                '</div>' +
                '<div class="block-actions">' +
                  '<button class="block-btn" onclick="editBlock(' + block.id + ')" title="Editar"><i class="bi bi-pencil"></i></button>' +
                  '<button class="block-btn toggle-btn ' + (block.active ? 'active' : '') + '" onclick="toggleBlock(' + block.id + ')" title="' + (block.active ? 'Desativar' : 'Ativar') + '"><i class="bi bi-' + (block.active ? 'eye' : 'eye-slash') + '"></i></button>' +
                  '<button class="block-btn danger" onclick="deleteBlock(' + block.id + ')" title="Excluir"><i class="bi bi-trash"></i></button>' +
                '</div>' +
              '</div>';
            }).join('')
          : '<div class="empty-blocks"><i class="bi bi-layout-wtf"></i><p>Nenhum bloco configurado</p><span>Clique em "Adicionar Bloco" para começar</span></div>'
        ) + `
      </div>
    </div>

    <!-- Painel de Tipos de Blocos -->
    <div class="editor-sidebar">
      <h3><i class="bi bi-grid-3x3-gap"></i> Tipos de Blocos</h3>
      <p class="sidebar-hint">Clique para adicionar um bloco</p>
      <div class="block-types">
        <div class="block-type-card" onclick="openAddBlockModal('featured')">
          <div class="block-type-preview">
            <div class="preview-layout featured-layout">
              <div class="preview-big"></div>
              <div class="preview-small-col"><div class="preview-sm"></div><div class="preview-sm"></div></div>
            </div>
          </div>
          <div class="block-type-info">
            <strong>Destaque Principal</strong>
            <span>1 grande + 2 pequenos</span>
          </div>
        </div>
        
        <div class="block-type-card" onclick="openAddBlockModal('highlight-2')">
          <div class="block-type-preview">
            <div class="preview-layout highlight2-layout">
              <div class="preview-half"></div>
              <div class="preview-half"></div>
            </div>
          </div>
          <div class="block-type-info">
            <strong>2 Destaques</strong>
            <span>2 notícias lado a lado</span>
          </div>
        </div>
        
        <div class="block-type-card" onclick="openAddBlockModal('grid-2')">
          <div class="block-type-preview">
            <div class="preview-layout grid2-layout">
              <div class="preview-card"></div>
              <div class="preview-card"></div>
            </div>
          </div>
          <div class="block-type-info">
            <strong>Grid 2 Colunas</strong>
            <span>2 cards por linha</span>
          </div>
        </div>
        
        <div class="block-type-card" onclick="openAddBlockModal('grid-3')">
          <div class="block-type-preview">
            <div class="preview-layout grid3-layout">
              <div class="preview-card"></div>
              <div class="preview-card"></div>
              <div class="preview-card"></div>
            </div>
          </div>
          <div class="block-type-info">
            <strong>Grid 3 Colunas</strong>
            <span>3 cards por linha</span>
          </div>
        </div>
        
        <div class="block-type-card" onclick="openAddBlockModal('grid-4')">
          <div class="block-type-preview">
            <div class="preview-layout grid4-layout">
              <div class="preview-card"></div>
              <div class="preview-card"></div>
              <div class="preview-card"></div>
              <div class="preview-card"></div>
            </div>
          </div>
          <div class="block-type-info">
            <strong>Grid 4 Colunas</strong>
            <span>4 cards por linha</span>
          </div>
        </div>
        
        <div class="block-type-card" onclick="openAddBlockModal('list-vertical')">
          <div class="block-type-preview">
            <div class="preview-layout list-layout">
              <div class="preview-list-item"><div class="preview-thumb"></div><div class="preview-lines"></div></div>
              <div class="preview-list-item"><div class="preview-thumb"></div><div class="preview-lines"></div></div>
              <div class="preview-list-item"><div class="preview-thumb"></div><div class="preview-lines"></div></div>
            </div>
          </div>
          <div class="block-type-info">
            <strong>Lista Vertical</strong>
            <span>Notícias em lista</span>
          </div>
        </div>
        
        <div class="block-type-card" onclick="openAddBlockModal('big-left')">
          <div class="block-type-preview">
            <div class="preview-layout bigleft-layout">
              <div class="preview-big-side"></div>
              <div class="preview-list-side"><div class="preview-mini"></div><div class="preview-mini"></div><div class="preview-mini"></div></div>
            </div>
          </div>
          <div class="block-type-info">
            <strong>Grande à Esquerda</strong>
            <span>1 grande + lista</span>
          </div>
        </div>
        
        <div class="block-type-card" onclick="openAddBlockModal('big-right')">
          <div class="block-type-preview">
            <div class="preview-layout bigright-layout">
              <div class="preview-list-side"><div class="preview-mini"></div><div class="preview-mini"></div><div class="preview-mini"></div></div>
              <div class="preview-big-side"></div>
            </div>
          </div>
          <div class="block-type-info">
            <strong>Grande à Direita</strong>
            <span>Lista + 1 grande</span>
          </div>
        </div>
        
        <div class="block-type-card" onclick="openAddBlockModal('carousel')">
          <div class="block-type-preview">
            <div class="preview-layout carousel-layout">
              <div class="preview-carousel-item"></div>
              <div class="preview-carousel-item"></div>
              <div class="preview-carousel-item partial"></div>
            </div>
          </div>
          <div class="block-type-info">
            <strong>Carrossel</strong>
            <span>Slider horizontal</span>
          </div>
        </div>
        
        <div class="block-type-card" onclick="openAddBlockModal('banner')">
          <div class="block-type-preview">
            <div class="preview-layout banner-layout">
              <div class="preview-banner"><i class="bi bi-badge-ad"></i></div>
            </div>
          </div>
          <div class="block-type-info">
            <strong>Banner</strong>
            <span>Publicidade</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Adicionar/Editar Bloco -->
<div class="modal-overlay" id="blockModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="modalTitle"><i class="bi bi-plus-lg"></i> Adicionar Bloco</h3>
      <button class="modal-close" onclick="closeModal()"><i class="bi bi-x-lg"></i></button>
    </div>
    <form id="blockForm" onsubmit="saveBlock(event)">
      <input type="hidden" id="blockId" name="id">
      
      <div class="form-group">
        <label>Tipo de Bloco</label>
        <div class="block-type-selector" id="blockTypeSelector">
          <label class="type-option">
            <input type="radio" name="type" value="featured" required>
            <div class="type-option-content">
              <div class="type-mini-preview featured-mini"></div>
              <span>Destaque</span>
            </div>
          </label>
          <label class="type-option">
            <input type="radio" name="type" value="highlight-2">
            <div class="type-option-content">
              <div class="type-mini-preview highlight2-mini"></div>
              <span>2 Destaques</span>
            </div>
          </label>
          <label class="type-option">
            <input type="radio" name="type" value="grid-2">
            <div class="type-option-content">
              <div class="type-mini-preview grid2-mini"></div>
              <span>Grid 2</span>
            </div>
          </label>
          <label class="type-option">
            <input type="radio" name="type" value="grid-3">
            <div class="type-option-content">
              <div class="type-mini-preview grid3-mini"></div>
              <span>Grid 3</span>
            </div>
          </label>
          <label class="type-option">
            <input type="radio" name="type" value="grid-4">
            <div class="type-option-content">
              <div class="type-mini-preview grid4-mini"></div>
              <span>Grid 4</span>
            </div>
          </label>
          <label class="type-option">
            <input type="radio" name="type" value="list-vertical">
            <div class="type-option-content">
              <div class="type-mini-preview list-mini"></div>
              <span>Lista</span>
            </div>
          </label>
          <label class="type-option">
            <input type="radio" name="type" value="big-left">
            <div class="type-option-content">
              <div class="type-mini-preview bigleft-mini"></div>
              <span>Grande Esq.</span>
            </div>
          </label>
          <label class="type-option">
            <input type="radio" name="type" value="big-right">
            <div class="type-option-content">
              <div class="type-mini-preview bigright-mini"></div>
              <span>Grande Dir.</span>
            </div>
          </label>
          <label class="type-option">
            <input type="radio" name="type" value="carousel">
            <div class="type-option-content">
              <div class="type-mini-preview carousel-mini"></div>
              <span>Carrossel</span>
            </div>
          </label>
          <label class="type-option">
            <input type="radio" name="type" value="banner">
            <div class="type-option-content">
              <div class="type-mini-preview banner-mini"></div>
              <span>Banner</span>
            </div>
          </label>
        </div>
      </div>

      <div class="form-group" id="titleGroup">
        <label>Título do Bloco (opcional)</label>
        <input type="text" name="title" id="blockTitle" placeholder="Ex: Últimas Notícias, Destaques...">
      </div>

      <div class="form-group" id="categoryGroup">
        <label>Categoria</label>
        <select name="category_id" id="blockCategory">
          <option value="">Todas as categorias</option>
          ` + categories.map(function(cat) { return '<option value="' + cat.id + '">' + cat.name + '</option>'; }).join('') + `
        </select>
      </div>

      <div class="form-group" id="bannerGroup" style="display: none;">
        <label>Banner</label>
        <select name="banner_id" id="blockBanner">
          <option value="">Selecione um banner</option>
          ` + banners.map(function(b) { return '<option value="' + b.id + '">' + b.title + '</option>'; }).join('') + `
        </select>
      </div>

      <div class="form-group" id="postsCountGroup">
        <label>Quantidade de Posts</label>
        <input type="number" name="posts_count" id="blockPostsCount" value="4" min="1" max="12">
      </div>

      <div class="form-group">
        <label>Opções de Exibição</label>
        <div class="checkbox-group">
          <label class="checkbox-item">
            <input type="checkbox" name="show_title" id="showTitle" checked>
            <span>Mostrar título da seção</span>
          </label>
          <label class="checkbox-item">
            <input type="checkbox" name="show_category" id="showCategory" checked>
            <span>Mostrar categoria</span>
          </label>
          <label class="checkbox-item">
            <input type="checkbox" name="show_excerpt" id="showExcerpt" checked>
            <span>Mostrar resumo</span>
          </label>
          <label class="checkbox-item">
            <input type="checkbox" name="show_date" id="showDate" checked>
            <span>Mostrar data</span>
          </label>
        </div>
      </div>

      <div class="form-group">
        <label>Cor de Fundo</label>
        <div class="color-picker">
          <input type="color" name="background_color" id="bgColor" value="#ffffff">
          <input type="text" id="bgColorText" value="#ffffff" maxlength="7">
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-cancel" onclick="closeModal()">Cancelar</button>
        <button type="submit" class="btn-save"><i class="bi bi-check-lg"></i> Salvar</button>
      </div>
    </form>
  </div>
</div>

<style>
/* Editor Layout */
.home-editor {
  padding: 0;
}

.editor-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 24px;
}

.editor-header h1 {
  font-size: 22px;
  font-weight: 700;
  color: #0f172a;
  margin: 0 0 4px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.editor-header h1 i {
  color: #3b82f6;
}

.editor-header p {
  font-size: 13px;
  color: #64748b;
  margin: 0;
}

.btn-add-block {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 20px;
  background: #3b82f6;
  color: #fff;
  border: none;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-add-block:hover {
  background: #2563eb;
  transform: translateY(-1px);
}

.editor-content {
  display: grid;
  grid-template-columns: 1fr 340px;
  gap: 24px;
  align-items: start;
}

/* Preview Area */
.editor-preview {
  background: #fff;
  border-radius: 12px;
  overflow: hidden;
}

.preview-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 20px;
  background: #f8fafc;
  border-bottom: 1px solid #e2e8f0;
  font-weight: 600;
  color: #475569;
}

.preview-header i {
  margin-right: 8px;
}

.preview-link {
  font-size: 13px;
  color: #3b82f6;
  text-decoration: none;
}

.preview-link:hover {
  text-decoration: underline;
}

/* Blocks Container */
.blocks-container {
  min-height: 400px;
  padding: 16px;
}

.empty-blocks {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 60px 20px;
  color: #94a3b8;
  text-align: center;
}

.empty-blocks i {
  font-size: 48px;
  margin-bottom: 16px;
}

.empty-blocks p {
  font-size: 16px;
  font-weight: 600;
  color: #64748b;
  margin: 0 0 4px;
}

.empty-blocks span {
  font-size: 13px;
}

/* Block Item */
.block-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px;
  background: #fff;
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  margin-bottom: 12px;
  transition: all 0.2s;
}

.block-item:hover {
  border-color: #3b82f6;
  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
}

.block-item.inactive {
  opacity: 0.6;
  background: #f8fafc;
}

.block-item.dragging {
  opacity: 0.5;
  border-style: dashed;
}

.block-item.drag-over {
  border-color: #3b82f6;
  border-width: 2px;
}

.block-drag-handle {
  cursor: grab;
  color: #cbd5e1;
  padding: 8px;
  transition: color 0.2s;
}

.block-drag-handle:hover {
  color: #64748b;
}

.block-drag-handle:active {
  cursor: grabbing;
}

.block-preview {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 12px;
}

.block-type-icon {
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #3b82f6, #8b5cf6);
  color: #fff;
  border-radius: 10px;
  font-size: 18px;
}

.block-info {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.block-type-label {
  font-size: 11px;
  font-weight: 600;
  color: #3b82f6;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.block-title {
  font-size: 14px;
  font-weight: 600;
  color: #0f172a;
}

.block-banner {
  font-size: 12px;
  color: #64748b;
}

.block-status {
  margin-right: 12px;
}

.status-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 600;
}

.status-badge.active {
  background: #dcfce7;
  color: #16a34a;
}

.status-badge.inactive {
  background: #f1f5f9;
  color: #64748b;
}

.block-actions {
  display: flex;
  gap: 4px;
}

.block-btn {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #f1f5f9;
  border: none;
  border-radius: 6px;
  color: #64748b;
  cursor: pointer;
  transition: all 0.2s;
}

.block-btn:hover {
  background: #e2e8f0;
  color: #0f172a;
}

.block-btn.toggle-btn.active {
  background: #dcfce7;
  color: #16a34a;
}

.block-btn.danger:hover {
  background: #fef2f2;
  color: #dc2626;
}

/* Sidebar */
.editor-sidebar {
  background: #fff;
  border-radius: 12px;
  padding: 20px;
}

.editor-sidebar h3 {
  font-size: 14px;
  font-weight: 600;
  color: #0f172a;
  margin: 0 0 4px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.editor-sidebar h3 i {
  color: #3b82f6;
}

.sidebar-hint {
  font-size: 12px;
  color: #94a3b8;
  margin: 0 0 16px;
}

.block-types {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.block-type-card {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
}

.block-type-card:hover {
  background: #eff6ff;
  border-color: #3b82f6;
}

.block-type-preview {
  width: 60px;
  height: 40px;
  background: #fff;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  padding: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.preview-layout {
  width: 100%;
  height: 100%;
  display: flex;
  gap: 2px;
}

/* Layout Previews */
.featured-layout {
  display: flex;
  gap: 2px;
}

.featured-layout .preview-big {
  flex: 2;
  background: linear-gradient(135deg, #3b82f6, #8b5cf6);
  border-radius: 2px;
}

.featured-layout .preview-small-col {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.featured-layout .preview-sm {
  flex: 1;
  background: #94a3b8;
  border-radius: 2px;
}

.highlight2-layout .preview-half {
  flex: 1;
  background: linear-gradient(135deg, #3b82f6, #8b5cf6);
  border-radius: 2px;
}

.grid2-layout, .grid3-layout, .grid4-layout {
  display: flex;
  gap: 2px;
}

.grid2-layout .preview-card,
.grid3-layout .preview-card,
.grid4-layout .preview-card {
  flex: 1;
  background: #94a3b8;
  border-radius: 2px;
}

.list-layout {
  flex-direction: column;
  gap: 2px;
}

.preview-list-item {
  display: flex;
  gap: 2px;
  flex: 1;
}

.preview-thumb {
  width: 16px;
  background: #94a3b8;
  border-radius: 2px;
}

.preview-lines {
  flex: 1;
  background: #e2e8f0;
  border-radius: 2px;
}

.bigleft-layout, .bigright-layout {
  display: flex;
  gap: 2px;
}

.preview-big-side {
  flex: 2;
  background: linear-gradient(135deg, #3b82f6, #8b5cf6);
  border-radius: 2px;
}

.preview-list-side {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.preview-mini {
  flex: 1;
  background: #94a3b8;
  border-radius: 2px;
}

.carousel-layout {
  display: flex;
  gap: 2px;
  overflow: hidden;
}

.preview-carousel-item {
  flex: 0 0 40%;
  background: #94a3b8;
  border-radius: 2px;
}

.preview-carousel-item.partial {
  opacity: 0.5;
}

.banner-layout {
  justify-content: center;
  align-items: center;
}

.preview-banner {
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #f59e0b, #ef4444);
  border-radius: 2px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-size: 12px;
}

.block-type-info {
  display: flex;
  flex-direction: column;
}

.block-type-info strong {
  font-size: 13px;
  color: #0f172a;
}

.block-type-info span {
  font-size: 11px;
  color: #64748b;
}

/* Modal */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s;
}

.modal-overlay.active {
  opacity: 1;
  visibility: visible;
}

.modal-content {
  background: #fff;
  border-radius: 16px;
  width: 100%;
  max-width: 600px;
  max-height: 90vh;
  overflow-y: auto;
  transform: translateY(20px);
  transition: transform 0.3s;
}

.modal-overlay.active .modal-content {
  transform: translateY(0);
}

.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px 24px;
  border-bottom: 1px solid #e2e8f0;
}

.modal-header h3 {
  font-size: 18px;
  font-weight: 600;
  color: #0f172a;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 10px;
}

.modal-header h3 i {
  color: #3b82f6;
}

.modal-close {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #f1f5f9;
  border: none;
  border-radius: 8px;
  color: #64748b;
  cursor: pointer;
  transition: all 0.2s;
}

.modal-close:hover {
  background: #e2e8f0;
  color: #0f172a;
}

#blockForm {
  padding: 24px;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  font-size: 13px;
  font-weight: 600;
  color: #374151;
  margin-bottom: 8px;
}

.form-group input[type="text"],
.form-group input[type="number"],
.form-group select {
  width: 100%;
  padding: 10px 14px;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  font-size: 14px;
  transition: all 0.2s;
}

.form-group input:focus,
.form-group select:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

/* Block Type Selector */
.block-type-selector {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 8px;
}

.type-option {
  cursor: pointer;
}

.type-option input {
  display: none;
}

.type-option-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  padding: 10px 6px;
  background: #f8fafc;
  border: 2px solid #e2e8f0;
  border-radius: 8px;
  transition: all 0.2s;
}

.type-mini-preview {
  width: 40px;
  height: 24px;
  background: #e2e8f0;
  border-radius: 4px;
  display: flex;
  gap: 2px;
  padding: 2px;
}

.featured-mini::before {
  content: '';
  flex: 2;
  background: #3b82f6;
  border-radius: 2px;
}

.featured-mini::after {
  content: '';
  flex: 1;
  background: #94a3b8;
  border-radius: 2px;
}

.highlight2-mini, .grid2-mini {
  display: flex;
  gap: 2px;
}

.highlight2-mini::before, .highlight2-mini::after,
.grid2-mini::before, .grid2-mini::after {
  content: '';
  flex: 1;
  background: #3b82f6;
  border-radius: 2px;
}

.grid3-mini {
  display: flex;
  gap: 2px;
}

.grid3-mini::before {
  content: '';
  flex: 1;
  background: #94a3b8;
  border-radius: 2px;
}

.grid4-mini {
  display: flex;
  gap: 1px;
}

.grid4-mini::before, .grid4-mini::after {
  content: '';
  flex: 1;
  background: #94a3b8;
  border-radius: 2px;
}

.list-mini {
  flex-direction: column;
  gap: 2px;
}

.list-mini::before, .list-mini::after {
  content: '';
  flex: 1;
  background: #94a3b8;
  border-radius: 2px;
}

.bigleft-mini::before {
  content: '';
  flex: 2;
  background: #3b82f6;
  border-radius: 2px;
}

.bigleft-mini::after {
  content: '';
  flex: 1;
  background: #94a3b8;
  border-radius: 2px;
}

.bigright-mini::before {
  content: '';
  flex: 1;
  background: #94a3b8;
  border-radius: 2px;
}

.bigright-mini::after {
  content: '';
  flex: 2;
  background: #3b82f6;
  border-radius: 2px;
}

.carousel-mini {
  overflow: hidden;
}

.carousel-mini::before, .carousel-mini::after {
  content: '';
  flex: 0 0 45%;
  background: #94a3b8;
  border-radius: 2px;
}

.banner-mini {
  background: linear-gradient(135deg, #f59e0b, #ef4444) !important;
}

.type-option-content span {
  font-size: 9px;
  font-weight: 600;
  color: #64748b;
  text-align: center;
}

.type-option input:checked + .type-option-content {
  background: #eff6ff;
  border-color: #3b82f6;
}

.type-option input:checked + .type-option-content span {
  color: #3b82f6;
}

/* Checkbox Group */
.checkbox-group {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}

.checkbox-item {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
}

.checkbox-item input {
  width: 16px;
  height: 16px;
  accent-color: #3b82f6;
}

.checkbox-item span {
  font-size: 13px;
  color: #475569;
}

/* Color Picker */
.color-picker {
  display: flex;
  align-items: center;
  gap: 10px;
}

.color-picker input[type="color"] {
  width: 44px;
  height: 44px;
  padding: 0;
  border: 2px solid #e2e8f0;
  border-radius: 8px;
  cursor: pointer;
}

.color-picker input[type="text"] {
  width: 100px;
  padding: 10px 14px;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  font-family: monospace;
}

/* Modal Footer */
.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  padding-top: 20px;
  border-top: 1px solid #e2e8f0;
  margin-top: 24px;
}

.btn-cancel {
  padding: 10px 20px;
  background: #f1f5f9;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  color: #64748b;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-cancel:hover {
  background: #e2e8f0;
}

.btn-save {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 20px;
  background: #3b82f6;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  color: #fff;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-save:hover {
  background: #2563eb;
}

/* Responsive */
@media (max-width: 1024px) {
  .editor-content {
    grid-template-columns: 1fr;
  }
  
  .editor-sidebar {
    order: -1;
  }
  
  .block-types {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 640px) {
  .editor-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 16px;
  }
  
  .btn-add-block {
    width: 100%;
    justify-content: center;
  }
  
  .block-type-selector {
    grid-template-columns: repeat(3, 1fr);
  }
  
  .checkbox-group {
    grid-template-columns: 1fr;
  }
}
</style>

<script>
// Modal
function openAddBlockModal(type) {
  document.getElementById('modalTitle').innerHTML = '<i class="bi bi-plus-lg"></i> Adicionar Bloco';
  document.getElementById('blockForm').reset();
  document.getElementById('blockId').value = '';
  
  if (type) {
    var radio = document.querySelector('input[name="type"][value="' + type + '"]');
    if (radio) {
      radio.checked = true;
      handleTypeChange(type);
    }
  }
  
  document.getElementById('blockModal').classList.add('active');
}

function closeModal() {
  document.getElementById('blockModal').classList.remove('active');
}

function handleTypeChange(type) {
  var bannerGroup = document.getElementById('bannerGroup');
  var categoryGroup = document.getElementById('categoryGroup');
  var postsCountGroup = document.getElementById('postsCountGroup');
  
  if (type === 'banner') {
    bannerGroup.style.display = 'block';
    categoryGroup.style.display = 'none';
    postsCountGroup.style.display = 'none';
  } else {
    bannerGroup.style.display = 'none';
    categoryGroup.style.display = 'block';
    postsCountGroup.style.display = 'block';
  }
}

// Event listeners para tipo de bloco
document.querySelectorAll('input[name="type"]').forEach(function(input) {
  input.addEventListener('change', function(e) {
    handleTypeChange(e.target.value);
  });
});

// Color picker sync
document.getElementById('bgColor').addEventListener('input', function(e) {
  document.getElementById('bgColorText').value = e.target.value;
});
document.getElementById('bgColorText').addEventListener('input', function(e) {
  if (/^#[0-9A-Fa-f]{6}$/.test(e.target.value)) {
    document.getElementById('bgColor').value = e.target.value;
  }
});

// Salvar bloco
async function saveBlock(e) {
  e.preventDefault();
  
  var form = document.getElementById('blockForm');
  var formData = new FormData(form);
  var blockId = document.getElementById('blockId').value;
  
  var data = {
    type: formData.get('type'),
    title: formData.get('title'),
    category_id: formData.get('category_id'),
    banner_id: formData.get('banner_id'),
    posts_count: formData.get('posts_count'),
    show_title: document.getElementById('showTitle').checked,
    show_category: document.getElementById('showCategory').checked,
    show_excerpt: document.getElementById('showExcerpt').checked,
    show_date: document.getElementById('showDate').checked,
    background_color: formData.get('background_color')
  };
  
  var url = blockId ? '/admin/home-editor/blocks/' + blockId : '/admin/home-editor/blocks';
  
  try {
    var res = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    
    var result = await res.json();
    if (result.success) {
      location.reload();
    } else {
      alert(result.message || 'Erro ao salvar bloco.');
    }
  } catch (err) {
    console.error(err);
    alert('Erro ao salvar bloco.');
  }
}

// Editar bloco
async function editBlock(id) {
  try {
    var res = await fetch('/admin/home-editor/blocks/' + id + '/preview');
    var result = await res.json();
    
    if (result.success) {
      var block = result.block;
      
      document.getElementById('modalTitle').innerHTML = '<i class="bi bi-pencil"></i> Editar Bloco';
      document.getElementById('blockId').value = block.id;
      document.getElementById('blockTitle').value = block.title || '';
      document.getElementById('blockCategory').value = block.category_id || '';
      document.getElementById('blockBanner').value = block.banner_id || '';
      document.getElementById('blockPostsCount').value = block.posts_count || 4;
      document.getElementById('showTitle').checked = block.show_title;
      document.getElementById('showCategory').checked = block.show_category;
      document.getElementById('showExcerpt').checked = block.show_excerpt;
      document.getElementById('showDate').checked = block.show_date;
      document.getElementById('bgColor').value = block.background_color || '#ffffff';
      document.getElementById('bgColorText').value = block.background_color || '#ffffff';
      
      var radio = document.querySelector('input[name="type"][value="' + block.type + '"]');
      if (radio) radio.checked = true;
      handleTypeChange(block.type);
      
      document.getElementById('blockModal').classList.add('active');
    }
  } catch (err) {
    console.error(err);
    alert('Erro ao carregar bloco.');
  }
}

// Toggle ativo (NÃO exclui, apenas desativa)
async function toggleBlock(id) {
  try {
    var res = await fetch('/admin/home-editor/blocks/' + id + '/toggle', { method: 'POST' });
    var result = await res.json();
    if (result.success) {
      location.reload();
    }
  } catch (err) {
    console.error(err);
  }
}

// Excluir bloco
async function deleteBlock(id) {
  if (!confirm('Tem certeza que deseja excluir este bloco?')) return;
  
  try {
    var res = await fetch('/admin/home-editor/blocks/' + id + '/delete', { method: 'POST' });
    var result = await res.json();
    if (result.success) {
      // Remover o elemento do DOM sem recarregar
      var blockEl = document.querySelector('.block-item[data-id="' + id + '"]');
      if (blockEl) {
        blockEl.remove();
      }
      // Se não houver mais blocos, mostrar mensagem vazia
      var container = document.getElementById('blocksContainer');
      if (container && container.querySelectorAll('.block-item').length === 0) {
        container.innerHTML = '<div class="empty-blocks"><i class="bi bi-layout-wtf"></i><p>Nenhum bloco configurado</p><span>Clique em "Adicionar Bloco" para começar</span></div>';
      }
    }
  } catch (err) {
    console.error(err);
  }
}

// Drag and Drop
document.addEventListener('DOMContentLoaded', function() {
  var container = document.getElementById('blocksContainer');
  if (!container) return;
  
  var draggedItem = null;
  
  container.querySelectorAll('.block-item').forEach(function(item) {
    var handle = item.querySelector('.block-drag-handle');
    
    handle.addEventListener('mousedown', function() {
      item.setAttribute('draggable', 'true');
    });
    
    item.addEventListener('dragstart', function(e) {
      draggedItem = this;
      this.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
    });
    
    item.addEventListener('dragend', function() {
      this.classList.remove('dragging');
      this.removeAttribute('draggable');
      container.querySelectorAll('.drag-over').forEach(function(el) {
        el.classList.remove('drag-over');
      });
      saveOrder();
    });
    
    item.addEventListener('dragover', function(e) {
      e.preventDefault();
      if (this !== draggedItem) {
        this.classList.add('drag-over');
      }
    });
    
    item.addEventListener('dragleave', function() {
      this.classList.remove('drag-over');
    });
    
    item.addEventListener('drop', function(e) {
      e.preventDefault();
      this.classList.remove('drag-over');
      
      if (this !== draggedItem) {
        var items = Array.from(container.querySelectorAll('.block-item'));
        var draggedIndex = items.indexOf(draggedItem);
        var targetIndex = items.indexOf(this);
        
        if (draggedIndex < targetIndex) {
          this.after(draggedItem);
        } else {
          this.before(draggedItem);
        }
      }
    });
  });
  
  async function saveOrder() {
    var items = Array.from(container.querySelectorAll('.block-item')).map(function(el) {
      return el.dataset.id;
    });
    
    try {
      await fetch('/admin/home-editor/reorder', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ items: items })
      });
    } catch (err) {
      console.error('Erro ao salvar ordem:', err);
    }
  }
});

// Fechar modal com ESC
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') closeModal();
});

// Fechar modal clicando fora
document.getElementById('blockModal').addEventListener('click', function(e) {
  if (e.target.id === 'blockModal') closeModal();
});
</script>
`}) %>
