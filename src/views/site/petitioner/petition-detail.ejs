<%- include('../layouts/main', { body: `

<div class="detail-page">
  <div class="container">
    <a href="/minha-conta" class="back-link"><i class="bi bi-arrow-left"></i> Voltar para Minhas Petições</a>

    <div class="detail-layout">
      <div class="detail-main">
        <div class="detail-card">
          ${petition.image ? '<div class="petition-image"><img src="' + petition.image + '" alt=""></div>' : ''}
          
          <div class="petition-content">
            <div class="status-row">
              <span class="status-badge ${petition.status === 'active' ? 'success' : petition.status === 'pending' ? 'warning' : petition.status === 'rejected' ? 'danger' : 'muted'}">
                ${petition.status === 'active' ? 'Ativa' : petition.status === 'pending' ? 'Aguardando Aprovação' : petition.status === 'rejected' ? 'Rejeitada' : petition.status === 'victory' ? 'Vitória!' : 'Encerrada'}
              </span>
              ${petition.category ? '<span class="category-badge">' + petition.category + '</span>' : ''}
            </div>

            <h1>${petition.title}</h1>

            <div class="meta-info">
              <span><i class="bi bi-calendar"></i> Criada em ${new Date(petition.created_at).toLocaleDateString('pt-BR')}</span>
              ${petition.approved_at ? '<span><i class="bi bi-check-circle"></i> Aprovada em ' + new Date(petition.approved_at).toLocaleDateString('pt-BR') + '</span>' : ''}
            </div>

            <div class="description">
              <h3>Descrição</h3>
              <p>${petition.description}</p>
            </div>

            ${petition.content ? '<div class="full-content"><h3>Conteúdo Completo</h3><div>' + petition.content.replace(/\\n/g, '<br>') + '</div></div>' : ''}

            ${petition.status === 'rejected' && petition.rejection_reason ? 
              '<div class="rejection-box"><h3><i class="bi bi-exclamation-triangle"></i> Motivo da Rejeição</h3><p>' + petition.rejection_reason + '</p></div>'
            : ''}

            ${petition.admin_notes ? 
              '<div class="admin-notes"><h3><i class="bi bi-chat-left-text"></i> Observações do Administrador</h3><p>' + petition.admin_notes + '</p></div>'
            : ''}
          </div>
        </div>

        <!-- Assinaturas Recentes -->
        ${petition.status === 'active' && recentSignatures.length > 0 ?
          '<div class="signatures-card">' +
            '<h2><i class="bi bi-people"></i> Últimas Assinaturas</h2>' +
            '<div class="signatures-list">' +
              recentSignatures.map(sig => 
                '<div class="signature-item">' +
                  '<div class="sig-avatar">' + sig.name.charAt(0).toUpperCase() + '</div>' +
                  '<div class="sig-info">' +
                    '<strong>' + sig.name + '</strong>' +
                    (sig.city ? '<span>' + sig.city + (sig.state ? ', ' + sig.state : '') + '</span>' : '') +
                  '</div>' +
                  '<span class="sig-date">' + new Date(sig.created_at).toLocaleDateString('pt-BR') + '</span>' +
                '</div>'
              ).join('') +
            '</div>' +
          '</div>'
        : ''}
      </div>

      <div class="detail-sidebar">
        <!-- Progresso -->
        <div class="progress-card">
          <div class="progress-circle">
            <svg viewBox="0 0 100 100">
              <circle class="bg" cx="50" cy="50" r="45"></circle>
              <circle class="fill" cx="50" cy="50" r="45" style="stroke-dashoffset: ${283 - (283 * progress / 100)}"></circle>
            </svg>
            <div class="progress-text">
              <span class="percent">${progress}%</span>
            </div>
          </div>
          <div class="progress-stats">
            <div class="stat">
              <span class="value">${signatureCount.toLocaleString('pt-BR')}</span>
              <span class="label">assinaturas</span>
            </div>
            <div class="stat">
              <span class="value">${petition.goal.toLocaleString('pt-BR')}</span>
              <span class="label">meta</span>
            </div>
          </div>
        </div>

        <!-- Ações -->
        ${petition.status === 'active' ?
          '<div class="actions-card">' +
            '<h3>Compartilhar</h3>' +
            '<p>Divulgue sua petição para conseguir mais assinaturas!</p>' +
            '<div class="share-buttons">' +
              '<a href="https://wa.me/?text=' + encodeURIComponent(petition.title + ' - ' + siteUrl + '/peticao/' + petition.slug) + '" target="_blank" class="share-btn whatsapp"><i class="bi bi-whatsapp"></i></a>' +
              '<a href="https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(siteUrl + '/peticao/' + petition.slug) + '" target="_blank" class="share-btn facebook"><i class="bi bi-facebook"></i></a>' +
              '<a href="https://twitter.com/intent/tweet?url=' + encodeURIComponent(siteUrl + '/peticao/' + petition.slug) + '&text=' + encodeURIComponent(petition.title) + '" target="_blank" class="share-btn twitter"><i class="bi bi-twitter-x"></i></a>' +
            '</div>' +
            '<a href="/peticao/' + petition.slug + '" target="_blank" class="btn-view-public"><i class="bi bi-box-arrow-up-right"></i> Ver Página Pública</a>' +
          '</div>'
        : ''}

        <!-- Info -->
        <div class="info-card">
          <h3>Informações</h3>
          <ul>
            <li><strong>Status:</strong> ${petition.status === 'active' ? 'Ativa' : petition.status === 'pending' ? 'Aguardando' : petition.status === 'rejected' ? 'Rejeitada' : 'Encerrada'}</li>
            <li><strong>Visualizações:</strong> ${petition.views || 0}</li>
            <li><strong>Categoria:</strong> ${petition.category || 'Não definida'}</li>
            ${petition.end_date ? '<li><strong>Encerra em:</strong> ' + new Date(petition.end_date).toLocaleDateString('pt-BR') + '</li>' : ''}
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .detail-page {
    padding: 40px 0 80px;
    background: #f8fafc;
    min-height: 100vh;
  }
  .back-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    color: #64748b;
    font-weight: 500;
    margin-bottom: 24px;
    text-decoration: none;
  }
  .back-link:hover {
    color: var(--primary-color, #3b82f6);
  }
  .detail-layout {
    display: grid;
    grid-template-columns: 1fr 340px;
    gap: 30px;
    align-items: start;
  }
  .detail-card {
    background: #fff;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }
  .petition-image {
    height: 300px;
    overflow: hidden;
  }
  .petition-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .petition-content {
    padding: 32px;
  }
  .status-row {
    display: flex;
    gap: 12px;
    margin-bottom: 16px;
  }
  .status-badge {
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
  }
  .status-badge.success { background: #dcfce7; color: #16a34a; }
  .status-badge.warning { background: #fef3c7; color: #d97706; }
  .status-badge.danger { background: #fee2e2; color: #dc2626; }
  .status-badge.muted { background: #f1f5f9; color: #64748b; }
  .category-badge {
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    background: #eff6ff;
    color: var(--primary-color, #3b82f6);
  }
  .petition-content h1 {
    font-size: 28px;
    font-weight: 800;
    color: #0f172a;
    margin: 0 0 16px;
    line-height: 1.3;
  }
  .meta-info {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    font-size: 14px;
    color: #64748b;
    margin-bottom: 24px;
    padding-bottom: 24px;
    border-bottom: 1px solid #f1f5f9;
  }
  .meta-info span {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .description h3, .full-content h3 {
    font-size: 16px;
    font-weight: 700;
    color: #0f172a;
    margin: 0 0 12px;
  }
  .description p, .full-content div {
    color: #475569;
    line-height: 1.7;
  }
  .full-content {
    margin-top: 24px;
    padding-top: 24px;
    border-top: 1px solid #f1f5f9;
  }
  .rejection-box {
    margin-top: 24px;
    padding: 20px;
    background: #fef2f2;
    border-radius: 12px;
    border-left: 4px solid #dc2626;
  }
  .rejection-box h3 {
    color: #dc2626;
    font-size: 15px;
    margin: 0 0 8px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .rejection-box p {
    color: #991b1b;
    margin: 0;
  }
  .admin-notes {
    margin-top: 24px;
    padding: 20px;
    background: #eff6ff;
    border-radius: 12px;
  }
  .admin-notes h3 {
    color: var(--primary-color, #3b82f6);
    font-size: 15px;
    margin: 0 0 8px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .admin-notes p {
    color: #1e40af;
    margin: 0;
  }
  .signatures-card {
    background: #fff;
    border-radius: 16px;
    padding: 24px;
    margin-top: 24px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }
  .signatures-card h2 {
    font-size: 18px;
    font-weight: 700;
    margin: 0 0 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .signatures-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  .signature-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: #f8fafc;
    border-radius: 10px;
  }
  .sig-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary-color, #3b82f6), #10b981);
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
  }
  .sig-info {
    flex: 1;
  }
  .sig-info strong {
    display: block;
    font-size: 14px;
    color: #0f172a;
  }
  .sig-info span {
    font-size: 12px;
    color: #64748b;
  }
  .sig-date {
    font-size: 12px;
    color: #94a3b8;
  }
  /* Sidebar */
  .progress-card, .actions-card, .info-card {
    background: #fff;
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 20px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }
  .progress-circle {
    width: 140px;
    height: 140px;
    margin: 0 auto 20px;
    position: relative;
  }
  .progress-circle svg {
    transform: rotate(-90deg);
    width: 100%;
    height: 100%;
  }
  .progress-circle circle {
    fill: none;
    stroke-width: 10;
  }
  .progress-circle .bg {
    stroke: #e2e8f0;
  }
  .progress-circle .fill {
    stroke: var(--primary-color, #3b82f6);
    stroke-linecap: round;
    stroke-dasharray: 283;
  }
  .progress-text {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .progress-text .percent {
    font-size: 32px;
    font-weight: 800;
    color: var(--primary-color, #3b82f6);
  }
  .progress-stats {
    display: flex;
    justify-content: center;
    gap: 40px;
    text-align: center;
  }
  .progress-stats .value {
    display: block;
    font-size: 24px;
    font-weight: 700;
    color: #0f172a;
  }
  .progress-stats .label {
    font-size: 13px;
    color: #64748b;
  }
  .actions-card h3, .info-card h3 {
    font-size: 16px;
    font-weight: 700;
    color: #0f172a;
    margin: 0 0 8px;
  }
  .actions-card p {
    font-size: 14px;
    color: #64748b;
    margin: 0 0 16px;
  }
  .share-buttons {
    display: flex;
    gap: 10px;
    margin-bottom: 16px;
  }
  .share-btn {
    width: 44px;
    height: 44px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-size: 18px;
    transition: all 0.2s;
  }
  .share-btn:hover {
    transform: scale(1.1);
  }
  .share-btn.whatsapp { background: #25d366; }
  .share-btn.facebook { background: #1877f2; }
  .share-btn.twitter { background: #000; }
  .btn-view-public {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 12px;
    background: #f1f5f9;
    color: #475569;
    border-radius: 10px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s;
  }
  .btn-view-public:hover {
    background: #e2e8f0;
    color: #1e293b;
  }
  .info-card ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  .info-card li {
    padding: 10px 0;
    border-bottom: 1px solid #f1f5f9;
    font-size: 14px;
    color: #475569;
  }
  .info-card li:last-child {
    border-bottom: none;
  }
  .info-card li strong {
    color: #0f172a;
  }
  @media (max-width: 900px) {
    .detail-layout { grid-template-columns: 1fr; }
  }
</style>

`}) %>
